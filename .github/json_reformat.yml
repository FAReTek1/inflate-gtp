name: JSON Reformatter
# generated by ai

on:
  push:
    paths:
      - '**.json' # Trigger on changes to any JSON file
  workflow_dispatch: # Allows manual trigger

jobs:
  format_json:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Reformat and overwrite JSON files
        # The '.' command in jq outputs the entire JSON structure, 
        # and 'del(.[])' is a workaround to force the output to be pretty-printed.
        # Alternatively, 'jq .' also works for basic pretty-printing.
        # The find command iterates over all .json files.
        run: |
          find . -type f -name "*.json" -print0 | while IFS= read -r -d $'\0' file; do
            echo "Formatting $file"
            jq '.' "$file" > tmp_file && mv tmp_file "$file"
          done
      
      - name: Commit formatted files (if changes exist)
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'style: reformat JSON files'
          branch: ${{ github.head_ref || github.ref_name }} # Works for both push and pull_request
